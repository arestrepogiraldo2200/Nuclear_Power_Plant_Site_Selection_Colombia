<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Map</title>
    <meta name="viewport" content="initial-scale=1.0, width=device-width" />
    <script src="https://js.api.here.com/v3/3.1/mapsjs-core.js" type="text/javascript" charset="utf-8"></script>
    <script src="https://js.api.here.com/v3/3.1/mapsjs-service.js" type="text/javascript" charset="utf-8"></script>
    <script src="https://js.api.here.com/v3/3.1/mapsjs-ui.js" type="text/javascript" charset="utf-8"></script>
    <script src="https://js.api.here.com/v3/3.1/mapsjs-mapevents.js" type="text/javascript" charset="utf-8"></script>
    <link href="https://js.api.here.com/v3/3.1/mapsjs-ui.css" type="text/css" rel="stylesheet"/>
    <script src="../private_data.js"></script>
    <link href = "style.css" rel="stylesheet"></style>
    <link href='https://fonts.googleapis.com/css?family=Space Mono' rel='stylesheet'>
    <link href='https://fonts.googleapis.com/css?family=Libre Caslon Text' rel='stylesheet'>
</head>

<body>

  <div class="title_container">
    <h1 class="title">
      Zonas de exclusión para una central nuclear de potencia en Colombia
    </h1>
  </div>

  <div class = "map">
    <div style = "width: 90vw; height: 93.5vh; padding: 0px; margin: 0px; border: 2px solid black;" id="mapContainer">
      <script type="text/javascript" charset="utf-8">

        // Initialize the platform object
        var platform = new H.service.Platform({
          apikey: MY_KEY
        });

        // Obtain the default map types from the platform object
        var maptypes = platform.createDefaultLayers();

        // Instantiate (and display) the map
        var map = new H.Map( document.getElementById('mapContainer'), maptypes.vector.normal.map,
        {
            zoom: 5.85,                                   // Initial zoom
            center: { lat:  4.5709, lng: -74.2973 },     // Coordinates of Colombia centroid
            pixelRatio: window.devicePixelRatio || 1

        });

        // Resize the map according to viewport size
        window.addEventListener('resize', () => map.getViewPort().resize());

        // Changes color of background
        window.addEventListener("load", () => { document.body.style.background = '#e1e7f1';});

        // User interactions in map
        var behavior = new H.mapevents.Behavior(new H.mapevents.MapEvents(map));

        // Objects for user interphase controllers
        var ui = H.ui.UI.createDefault(map, maptypes);

        // Controls
        ui.removeControl("mapsettings");
        var zoom = ui.getControl('zoom');
        var scalebar = ui.getControl('scalebar');

        // Function to display coordinates by mouse click
        function setUpClickListener(map) {

          map.addEventListener('tap', function (evt) {

            var coord = map.screenToGeo(evt.currentPointer.viewportX, evt.currentPointer.viewportY);
            var output = document.getElementById('coords');
            coords.innerHTML = 'Coordenadas del último click: lat: ' + coord.lat.toFixed(6)  + ',  lng: ' + coord.lng.toFixed(6);

          });
        }

        setUpClickListener(map);

        // Function to restrict map view
        function restrictMap(map){

          // Get map current zoom
          map.getViewModel().addEventListener('sync', function(e) {

          // Restrict zoom to no less than 5.85
          let zoom = map.getZoom();
          if (zoom < 5.85){
            map.setZoom(5.85);
          }

          // Get map current boundaries
          var mapViewBounds = map.getViewModel().getLookAtData().bounds.getBoundingBox();
          var topMap = mapViewBounds.getTop();
          var bottomMap = mapViewBounds.getBottom();
          var leftMap = mapViewBounds.getLeft();
          var rightMap = mapViewBounds.getRight();

          // Restrict map view to focus on Colombia only
          if (topMap > 13.9 || bottomMap < -4.9 || leftMap < -92.5 || rightMap > -56.1){
              map.setCenter({ lat:  4.5709, lng: -74.2973 });
          }
        });
        }
        
        restrictMap(map);

      </script>
      

    </div>
  </div>


  <div class = "coords" style="font-family: 'Space Mono'; padding-bottom: 10px;">
    <p id = "coords">Coordenadas del último click: </p>
  </div>

  <div class = "exclusion" style="font-family: 'Space Mono'; padding-bottom: 10px;">
    <div class = "excl_container"><p id = "excl" style = "font-weight: 400;">Criterios de exclusión (click para graficar o borrar del mapa): </p></div>
    
    <!-- Inputs and spans to account for the user requested exclusion zones. Uses sessionStorage object to save the state of each checkbox -->
    <div class = "excl_container">
      <input type="checkbox" id = "population_exclusion" onclick="if(this.checked)sessionStorage.setItem(this.id,this.value);else sessionStorage.removeItem(this.id);">
      <span class="checkmark" id="checkmark_population_exclusion"></span>
      <p id = "excl">Tamaño de población</p>
    </div>
    
    <div class = "excl_container">
      <input type="checkbox" id = "flights_exclusion" onclick="if(this.checked)sessionStorage.setItem(this.id,this.value);else sessionStorage.removeItem(this.id);">
      <span class="checkmark" id="checkmark_flights_exclusion"></span>
      <p id = "excl">Rutas aéreas nacionales y aeropuertos</p>
    </div>
    
    <div class = "excl_container">
      <input type="checkbox" id = "overland_flights_exclusion" onclick="if(this.checked)sessionStorage.setItem(this.id,this.value);else sessionStorage.removeItem(this.id);">
      <span class="checkmark" id="checkmark_overland_flights_exclusion"></span>
      <p id = "excl">Otras rutas aéreas sobre el territorio Colombiano</p>
    </div>

    <div class = "excl_container">
      <input type="checkbox" id = "volcanoe_exclusion" onclick="if(this.checked)sessionStorage.setItem(this.id,this.value);else sessionStorage.removeItem(this.id);">
      <span class="checkmark" id="checkmark_volcanoe_exclusion"></span>
      <p id = "excl">Volcanes y riesgo por actividad volcánica (?)</p>
    </div>
  
    <div class = "excl_container">
      <input type="checkbox" id = "high_sismicity" onclick="if(this.checked)sessionStorage.setItem(this.id,this.value);else sessionStorage.removeItem(this.id);">
      <span class="checkmark" id="checkmark_high_sismicity"></span>
      <p id = "excl">Alta sismicidad</p>
    </div>

    <div class = "excl_container">
      <input type="checkbox" id = "medium_sismicity" onclick="if(this.checked)sessionStorage.setItem(this.id,this.value);else sessionStorage.removeItem(this.id);">
      <span class="checkmark" id="checkmark_medium_sismicity"></span>
      <p id = "excl">Media sismicidad</p>
    </div>

    <div class = "excl_container">
      <input type="checkbox" id = "low_sismicity" onclick="if(this.checked)sessionStorage.setItem(this.id,this.value);else sessionStorage.removeItem(this.id);">
      <span class="checkmark" id="checkmark_low_sismicity"></span>
      <p id = "excl">Baja sismicidad</p>
    </div>

    <div class = "excl_container">
      <input type="checkbox" id = "geological_failure" onclick="if(this.checked)sessionStorage.setItem(this.id,this.value);else sessionStorage.removeItem(this.id);">
      <span class="checkmark" id="checkmark_geological_failure"></span>
      <p id = "excl">Fallas geológicas</p>
    </div>

    <div class = "excl_container">
      <input type="checkbox" id = "all_same_color">
      <span class="checkmark" id="checkmark_all_same_color"></span>
      <p id = "excl">Trazar zonas de exclusión del mismo color</p>
    </div>

    <div class = "excl_container">
      <input type="checkbox" id = "excltest" onclick="if(this.checked)sessionStorage.setItem(this.id,this.value);else sessionStorage.removeItem(this.id);">
      <span class="checkmark" id="excltest"></span>
      <p id = "excl">Criterio de exclusión</p>
    </div>
  </div>

  <script type="text/javascript">

    console.log(sessionStorage);

    for (var i=0; i<sessionStorage.length; i++){
        var key = sessionStorage.key(i);
        document.getElementById(key).checked=1;
    }
  </script>

  <div class = "info" style="font-family: 'Space Mono'; padding-bottom: 10px;">
    <p id = "inf">Alejandro Restrepo Giraldo, Nataly Gómez Garzón. 2023</p>
    <p id = "inf">Artículo ------ poner href cuando exista </p>
    <p id = "inf">Versión ------ </p>
  </div>

  <script src="amenazaSismica.js"></script>
  <script src="pupulation.js"></script>
  <script src="flights.js"></script>
  <script src="overland_flights.js"></script>
  <script src="volcanoes.js"></script>
  <script src="fallasGeologicas.js"></script>


</body>
<footer>
</footer>
</html>